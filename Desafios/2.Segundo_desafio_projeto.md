
# Segundo desafio de projeto: Explorando Workflows Automatizados com AWS Step Functions 

<div align="justify">


O segundo desafio de projeto consiste na criação de um workflow automatizado com o AWS Step Functions. O workflow será aplicado ao sistema de controle de acesso desenvolvido no primeiro desafio. Serão feitas adaptações nos serviços utilizados, de modo a torná-los mais adequados a esse novo contexto. 

O Step Functions vai orquestrar o fluxo entre os serviços: 

* AWS Lambda (substitui parte da lógica do EC2);
* Amazon DynamoDB (no lugar do EBS, para persistência simples);
* Amazon S3 (para logs de acesso);
* SNS/SQS ou API Gateway (para comunicação com o leitor de crachá ou catraca).

### :twisted_rightwards_arrows: Fluxo de trabalho

:one: **Funcionário aproxima o crachá**  
O leitor envia um evento (por exemplo via API Gateway) para iniciar a execução no Step Functions. 

:two: **Step Functions chama Lambda “ValidaCrachá”**  
Função verifica se o crachá existe e está ativo no banco (DynamoDB). 

:three: **Decisão (Choice State)**  

* Se válido → segue para etapa “Acesso Liberado”. 

* Se inválido → segue para etapa “Acesso Negado”. 

:four: **Registrar no S3**  
Grava log de acesso (autorizado ou negado) no bucket de logs. 

:five: **Retornar resultado à catraca**
Chama um endpoint via API Gateway para acionar o hardware. 

### Exemplo de Definição de Máquina de Estado (JSON) 

A seguir um exemplo simples de definição do fluxo no formato Amazon States Language:  


```json
{ 

  "Comment": "Fluxo de controle de acesso", 

  "StartAt": "ValidarCrachá", 

  "States": { 

    "ValidarCrachá": { 

      "Type": "Task", 

      "Resource": "arn:aws:lambda:us-east-1:123456789012:function:ValidaCracha", 

      "Next": "DecisaoAcesso" 

    }, 

    "DecisaoAcesso": { 

      "Type": "Choice", 

      "Choices": [ 

        { 

          "Variable": "$.acessoPermitido", 

          "BooleanEquals": true, 

          "Next": "RegistrarAcessoLiberado" 

        } 

      ], 

      "Default": "RegistrarAcessoNegado" 

    }, 

    "RegistrarAcessoLiberado": { 

      "Type": "Task", 

      "Resource": "arn:aws:lambda:us-east-1:123456789012:function:RegistrarAcesso", 

      "Parameters": { 

        "status": "LIBERADO", 

        "cracha.$": "$.cracha" 

      }, 

      "Next": "AbrirCatraca" 

    }, 

    "RegistrarAcessoNegado": { 

      "Type": "Task", 

      "Resource": "arn:aws:lambda:us-east-1:123456789012:function:RegistrarAcesso", 

      "Parameters": { 

        "status": "NEGADO", 

        "cracha.$": "$.cracha" 

      }, 

      "Next": "TravarCatraca" 

    }, 

    "AbrirCatraca": { 

      "Type": "Task", 

      "Resource": "arn:aws:lambda:us-east-1:123456789012:function:ControlaCatraca", 

      "Parameters": { 

        "acao": "abrir" 

      }, 

      "End": true 

    }, 

    "TravarCatraca": { 

      "Type": "Task", 

      "Resource": "arn:aws:lambda:us-east-1:123456789012:function:ControlaCatraca", 

      "Parameters": { 

        "acao": "travar" 

      }, 

      "End": true 

    } 

  } 

} 
```

Com a implementação do Step Functions, é possível ter insights de todo o serviço: 


* **Monitoramento do fluxo completo:** identificar onde ocorrem falhas ou atrasos. 

* **Tempo total de execução por fluxo:** medir quanto tempo cada tentativa de acesso leva do início ao fim. 

* **Taxa de sucesso vs. falha:** comparar quantos fluxos resultaram em “Acesso liberado” vs. “Acesso negado”. 

* **Reexecuções automáticas:** detectar quantos fluxos precisaram ser reprocessados devido a erro de função (ex: Lambda). 

* **Custo por execução:** estimar o custo total de cada fluxo com base nas execuções e serviços acionados. 

* **Análise de padrões de erro:** entender quais etapas falham com mais frequência e ajustar o fluxo. 

* **Escalabilidade e performance:** avaliar se o número de execuções simultâneas impacta o tempo de resposta. 

</div>

 