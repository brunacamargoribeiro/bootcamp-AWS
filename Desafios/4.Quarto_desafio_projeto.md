# Quarto desafio de projeto: Infraestrutura automatizada com AWS CloudFormation  

<div align="justify">

### :dart: Objetivo 

Aprofundar o uso do AWS CloudFormation, aplicando o conceito de Infraestrutura como Código (IaC) para automatizar a criação, configuração e gerenciamento de recursos AWS. 
O desafio visa padronizar, replicar e proteger ambientes em nuvem, simulando cenários reais de provisionamento automatizado e seguro. 

### :book: Contexto

Dando continuidade ao projeto anterior — o Sistema de Controle de Acesso — este desafio tem como foco tornar a infraestrutura totalmente automatizada e escalável. 
Agora, em vez de criar manualmente uma stack simples, o objetivo é estruturar templates mais completos, que representem ambientes padronizados e reutilizáveis. 

### :key: Conceitos-chave explorados  


* **IaC (Infrastructure as Code):** gerenciamento de recursos por meio de código (YAML/JSON), permitindo automação e versionamento. 

* **Padronização:** uso de templates consistentes para criar ambientes idênticos (ex: desenvolvimento, testes e produção). 

* **Replicação:** reutilização dos mesmos templates em diferentes regiões ou contas AWS. 

* **Segurança:** controle de permissões, isolamento de ambientes e automação de boas práticas via Policies e Roles. 

* **Automação:** criação de pilhas completas com um único comando, reduzindo erro humano.  

### :brain: Aplicação na prática  

O template criado neste desafio será uma evolução do desafio 3, adicionando novos elementos ao sistema de controle de acesso. 

Criação automática de: 

 
* **Bucket S3** para logs de acesso; 

* **Instância EC2** para validação dos crachás; 

* **Função IAM (Role)** com permissões controladas para acesso ao S3; 

* **Security Group** para definir regras de acesso de rede. 

Esses recursos serão definidos e configurados diretamente no template CloudFormation, sem necessidade de ações manuais no console. 

### :bookmark_tabs: Template CloudFormation (YAML) 

 ```yaml

AWSTemplateFormatVersion: '2010-09-09' 

Description: "Template CloudFormation - Sistema de Controle de Acesso" 

  

Parameters: 

  InstanceType: 

    Type: String 

    Default: t2.micro 

    Description: Tipo da instância EC2. 

  
Resources: 
  

  ## Bucket S3 para armazenamento de logs de acesso 

  LogsBucket: 

    Type: AWS::S3::Bucket 

    Properties: 

      BucketName: "controle-acesso-logs-DIO" 

      VersioningConfiguration: 

        Status: Enabled 

      Tags: 

        - Key: Projeto 

          Value: Desafio4-ControleAcesso 

  
  ## Função IAM com permissões limitadas para a EC2 escrever logs no S3 

  ControleAcessoRole: 

    Type: AWS::IAM::Role 

    Properties: 

      AssumeRolePolicyDocument: 

        Version: "2012-10-17" 

        Statement: 

          - Effect: Allow 

            Principal: 

              Service: ec2.amazonaws.com 

            Action: sts:AssumeRole 

      Policies: 

        - PolicyName: S3AccessPolicy 

          PolicyDocument: 

            Version: "2012-10-17" 

            Statement: 

              - Effect: Allow 

                Action: 

                  - s3:PutObject 

                Resource: !Sub "${LogsBucket.Arn}/*" 

  
  ## Perfil de instância vinculado à Role 

  ControleAcessoInstanceProfile: 

    Type: AWS::IAM::InstanceProfile 

    Properties: 

      Roles: 

        - !Ref ControleAcessoRole 

  

  ## Security Group com regras básicas de acesso (porta 22 para SSH e 80 para HTTP) 

  ControleAcessoSecurityGroup: 

    Type: AWS::EC2::SecurityGroup 

    Properties: 

      GroupDescription: Permitir acesso SSH e HTTP 

      SecurityGroupIngress: 

        - IpProtocol: tcp 

          FromPort: 22 

          ToPort: 22 

          CidrIp: 0.0.0.0/0 

        - IpProtocol: tcp 

          FromPort: 80 

          ToPort: 80 

          CidrIp: 0.0.0.0/0 

      Tags: 

        - Key: Name 

          Value: SG-ControleAcesso 

  

  ## Instância EC2 representando o servidor de validação de crachás 

  ControleAcessoEC2: 

    Type: AWS::EC2::Instance 

    Properties: 

      InstanceType: !Ref InstanceType 

      ImageId: ami-0c02fb55956c7d316 

      IamInstanceProfile: !Ref ControleAcessoInstanceProfile 

      SecurityGroupIds: 

        - !Ref ControleAcessoSecurityGroup 

      Tags: 

        - Key: Name 

          Value: ServidorControleAcesso 

  

Outputs: 

  BucketName: 

    Description: "Bucket S3 usado para armazenar logs de acesso" 

    Value: !Ref LogsBucket 

  

  EC2InstanceId: 

    Description: "ID da instância EC2 criada para o sistema de controle de acesso" 

    Value: !Ref ControleAcessoEC2 

  

  RoleName: 

    Description: "Nome da Role IAM associada à instância EC2" 

    Value: !Ref ControleAcessoRole  
    
```

### :white_check_mark: O que esse template faz 

 

1. Cria um bucket S3 versionado para armazenar logs de acesso. 

2. Cria uma IAM Role que permite à EC2 escrever objetos nesse bucket. 

3. Cria um Instance Profile que vincula a Role à instância EC2. 

4. Cria um Security Group com regras básicas de rede (SSH e HTTP). 

5. Cria uma instância EC2 que simula o servidor do sistema de controle de acesso. 

6. Exibe outputs com os recursos criados. 

### :rocket: Como implantar 

Salve o arquivo como `cloudformation-controle-acesso.yaml` e execute o comando no terminal:  

```bash
aws cloudformation create-stack \ 

  --stack-name Desafio4-ControleAcesso \ 

  --template-body file://cloudformation-controle-acesso.yaml \ 

  --capabilities CAPABILITY_IA
```

### :mag_right: Conceitos reforçados 
 

* **Infraestrutura como Código (IaC):** toda a criação e configuração é feita por meio de código, garantindo rastreabilidade e controle. 

* **Padronização:** o mesmo template pode ser reutilizado por qualquer pessoa, reproduzindo a infraestrutura de forma idêntica. 

* **Segurança:** permissões definidas de forma explícita na Role e controle de acesso configurado via Security Group. 

* **Automação:** provisionamento completo executado com um único comando, eliminando a necessidade de interação manual no console.  


### :speech_balloon: Resultados esperados 

Após a execução do template: 

* A infraestrutura será provisionada automaticamente, sem etapas manuais; 

* Os recursos permanecerão padronizados e devidamente documentados no código; 

* A stack poderá ser replicada em outras regiões ou atualizada com versionamento, fortalecendo as práticas de DevOps e governança. 

</div>

 
    
    
